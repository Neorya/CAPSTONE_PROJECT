Enum user_role {
  student
  teacher
  admin
}

Table users {
  id integer [primary key, increment] // SERIAL
  google_sub varchar(255) [unique, not null]
  email varchar(150) [unique, not null]
  first_name varchar(100) [not null]
  last_name varchar(100) [not null]
  role user_role [not null, default: 'student']
  score integer [not null, default: 0, note: 'CHECK (score <= 2000000)']
  profile_url text
  created_at timestamptz [not null, default: `now()`]
  updated_at timestamptz [not null, default: `now()`]
}

Table refresh_tokens {
  id integer [primary key, increment] // SERIAL
  user_id integer [not null] // FK -> users.id (ON DELETE CASCADE)
  token_hash text [unique, not null]
  expires_at timestamptz [not null]
  revoked_at timestamptz
  created_at timestamptz [not null, default: `now()`]

  Indexes {
    user_id
    expires_at
  }
}

Table teacher {
  teacher_id integer [primary key, increment] // SERIAL
  first_name varchar(100) [not null]
  last_name varchar(100) [not null]
  email varchar(150) [unique, not null]
}

Table match_setting {
  match_set_id integer [primary key, increment] // SERIAL
  title varchar(150) [not null, unique]
  description text [not null]
  is_ready boolean [not null, default: false]
  public_test varchar(500)
  private_test varchar(500)
  reference_solution varchar(1000)
  creator_id integer // FK -> teacher.teacher_id
}

Table match {
  match_id integer [primary key, increment] // SERIAL
  title varchar(150) [not null]
  match_set_id integer // FK -> match_setting.match_set_id
  creator_id integer // FK -> teacher.teacher_id
  difficulty_level integer [not null]
  review_number integer [not null]
  duration_phase1 integer [not null] // in minutes
  duration_phase2 integer [not null] // in minutes
}

Table game_session {
  game_id integer [primary key, increment] // SERIAL
  name varchar(150) [not null]
  start_date timestamp [not null]
  creator_id integer [not null] // FK -> teacher.teacher_id
  is_active boolean [not null, default: false]
}

Table matches_for_game {
  match_for_game_id integer [primary key, increment] // SERIAL
  match_id integer [not null] // FK -> match.match_id
  game_id integer [not null] // FK -> game_session.game_id

  Indexes {
    (match_id, game_id) [unique] // uc_matches_for_game
  }
}

Table student {
  student_id integer [primary key, increment] // SERIAL
  email varchar(150) [unique, not null]
  first_name varchar(100) [not null]
  last_name varchar(100) [not null]
  score integer [not null, default: 0, note: 'CHECK (score <= 2000000)']
}

Table student_join_game {
  student_join_game_id integer [primary key, increment] // SERIAL
  student_id integer [not null] // FK -> student.student_id
  game_id integer [not null] // FK -> game_session.game_id
  assigned_match_id integer // FK -> match.match_id (nullable)

  Indexes {
    (student_id, game_id) [unique] // uc_student_game
  }
}

// Relationships (per postgres/configs/init.sql)
Ref: refresh_tokens.user_id > users.id [delete: cascade]
Ref: match_setting.creator_id > teacher.teacher_id
Ref: match.creator_id > teacher.teacher_id
Ref: match.match_set_id > match_setting.match_set_id
Ref: game_session.creator_id > teacher.teacher_id
Ref: matches_for_game.match_id > match.match_id
Ref: matches_for_game.game_id > game_session.game_id
Ref: student_join_game.student_id > student.student_id
Ref: student_join_game.game_id > game_session.game_id
Ref: student_join_game.assigned_match_id > match.match_id
